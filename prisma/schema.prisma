// This is your database schema for the Portfolio & AI Analytics engine
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            String      @id @default(cuid())
  email         String      @unique
  name          String?
  portfolios    Portfolio[]
  createdAt     DateTime    @default(now())
}

model Portfolio {
  id              String   @id @default(cuid())
  slug            String   @unique // URL for hosting: username.platform.com/slug
  title           String
  ownerId         String
  owner           User     @relation(fields: [ownerId], references: [id])
  projects        Project[]
  templateConfig  Json     // UI Theme settings
  
  // AI Strategic Insights
  marketAlignment Float?   // Score 0-1
  narrativeScore  Int?     // Quality score of the storytelling
  
  published       Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Project {
  id              String   @id @default(cuid())
  portfolioId     String
  portfolio       Portfolio @relation(fields: [portfolioId], references: [id])
  rawDescription  String   @db.Text
  aiOptimizedDesc String?  @db.Text // The "Impact" story
  vectorId        String?  // Reference to external Vector DB or pgvector column
  mediaUrls       String[]
  skills          String[]
}

model AnalyticsEvent {
  id          String   @id @default(uuid())
  portfolioId String
  eventType   String   // e.g., "VIEW", "CONTACT_CLICK", "CV_DOWNLOAD"
  metadata    Json     // Browser, Region, Duration
  timestamp   DateTime @default(now())
}